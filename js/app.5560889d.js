(function(){"use strict";var e={4306:function(e,t,n){var a=n(144),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:"",color:"#fff",dark:""}},[n("div",{staticStyle:{display:"flex","justify-content":"space-between",width:"2000px"}},[n("div",{staticStyle:{"margin-left":"30px"}},[n("h5",{staticStyle:{"font-size":"25px",color:"black"}},[e._v(" Tải xuống hàng loạt tệp đính kèm Outlook Mail ")])]),n("div",{staticClass:"d-flex align-center",staticStyle:{"margin-right":"30px"}})])]),n("v-main",[n("MailAttachmentsDownload")],1),n("v-footer",[e._v(" HienHoang ")])],1)},i=[],o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{staticStyle:{"margin-top":"50px"}},[n("v-row",[n("v-col",{staticStyle:{"text-align":"right","margin-right":"15px","margin-top":"3px"},attrs:{cols:"2"}},[n("v-btn",{attrs:{color:"primary",target:"_blank",href:"https://developer.microsoft.com/en-us/graph/graph-explorer"}},[e._v(" Lấy token ")])],1),n("v-col",{attrs:{cols:"9"}},[n("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on,r=t.attrs;return[n("v-row",[n("v-text-field",e._g(e._b({attrs:{label:"Access token",required:"",type:"password",rules:[function(e){return!!e||"Vui lòng điền access token!"}]},model:{value:e.accessToken,callback:function(t){e.accessToken=t},expression:"accessToken"}},"v-text-field",r,!1),a))],1),n("v-row",{staticStyle:{display:"flex","justify-content":"flex-end"}},[n("a",{attrs:{target:"_blank",href:"https://innate-rule-d91.notion.site/H-ng-d-n-l-y-Microsoft-Access-Token-cho-REST-API-31a8a72003a94f5a892a593eb9b0a683"}},[e._v(" Hướng dẫn lấy Token")])])]}}])},[n("span",[e._v("Mã truy cập định danh cho từng tài khoản Outlook. Giữ bí mật mã này để tránh bị truy cập tài khoản trái phép.")])])],1)],1),n("v-row",{staticStyle:{"margin-bottom":"18px"}},[n("v-col",{staticStyle:{"margin-right":"15px"},attrs:{cols:"2"}}),n("v-col",{staticStyle:{padding:"0"},attrs:{cols:"9"}},[n("v-menu",{ref:"dateRangeMenu",attrs:{"close-on-content-click":!1,transition:"scale-transition"},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on,r=t.attrs;return[n("v-text-field",e._g(e._b({attrs:{value:e.dateRangeText,label:"Chọn khoảng ngày","prepend-icon":"mdi-calendar",readonly:""}},"v-text-field",r,!1),a))]}}]),model:{value:e.rangeDateMenu,callback:function(t){e.rangeDateMenu=t},expression:"rangeDateMenu"}},[n("v-date-picker",{attrs:{max:e.toDate},model:{value:e.fromDateComputed,callback:function(t){e.fromDateComputed=t},expression:"fromDateComputed"}},[n("v-spacer"),n("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){e.rangeDateMenu=!1}}},[e._v(" Cancel ")]),n("v-btn",{attrs:{text:"",color:"primary"},on:{click:function(t){return e.$refs.dateRangeMenu.save(e.dateRanges)}}},[e._v(" OK ")])],1)],1)],1)],1),n("v-row",{staticStyle:{"margin-left":"0",display:"flex","justify-content":"center"}},[e.fetchingMail?[n("v-btn",{attrs:{disabled:""}},[e._v(" "+e._s("Đang tải về mail... ("+this.items.length+")")+" ")]),n("v-progress-linear",{attrs:{indeterminate:"",color:"cyan"}})]:[n("v-btn",{staticClass:"mr-4",attrs:{color:"success",disabled:this.fetchingAttachment>0||!this.accessToken},on:{click:e.fetchMails}},[e._v(" Tải danh sách Email ")])]],2),n("v-divider",{staticStyle:{"margin-top":"30px"}}),e.fetchingMail?e._e():[n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.itemsComputed,"single-select":!1,"item-key":"index","show-select":"","items-per-page":-1,height:"50vh"},scopedSlots:e._u([{key:"item.hasAttachments",fn:function(t){var a=t.item;return[n("v-checkbox",{attrs:{disabled:""},model:{value:a.hasAttachments,callback:function(t){e.$set(a,"hasAttachments",t)},expression:"item.hasAttachments"}})]}},{key:"item.id",fn:function(e){}},e.items.length?{key:"top",fn:function(){return[n("v-row",[n("v-col",{attrs:{cols:"4"}},[n("v-switch",{staticStyle:{"margin-left":"30px"},attrs:{label:"Chỉ mail có đính kèm"},model:{value:e.onlyAttachmentMail,callback:function(t){e.onlyAttachmentMail=t},expression:"onlyAttachmentMail"}})],1),n("v-col",{attrs:{cols:"8"}},[n("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on,r=t.attrs;return[n("v-text-field",e._g(e._b({attrs:{label:"Danh sách người gửi"},model:{value:e.senderMailsRaw,callback:function(t){e.senderMailsRaw=t},expression:"senderMailsRaw"}},"v-text-field",r,!1),a))]}}],null,!1,1273527344)},[n("span",[e._v(" Danh sách mail của người gửi cần lọc, phân tách bởi dấu phẩy (,) hoặc khoảng trống. ")])])],1)],1)]},proxy:!0}:null],null,!0),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],e.selected.length>0?[n("v-btn",{staticClass:"mr-4",staticStyle:{"margin-top":"15px"},attrs:{color:"success",disabled:this.fetchingAttachment>0},on:{click:function(t){return e.downloadAttachments()}}},[0===this.fetchingAttachment?[e._v(" Tải danh sách đính kèm đã chọn ("+e._s(e.selected.length)+") ")]:[e._v(" "+e._s("Đang download... "+(e.fetchingMaxAttachment-e.fetchingAttachment)+"/"+e.fetchingMaxAttachment)+" ")]],2),e.fetchingAttachment>0?[n("v-progress-linear",{attrs:{color:"teal","buffer-value":"0",value:(e.fetchingMaxAttachment-e.fetchingAttachment)/e.fetchingMaxAttachment*100,height:"12",stream:""}})]:e._e()]:e.items.length>0&&!e.fetchingMail?[n("v-tooltip",{attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(t){var a=t.on,r=t.attrs;return[n("v-btn",e._g(e._b({staticClass:"mr-4",staticStyle:{"margin-top":"15px"},attrs:{color:"success"}},"v-btn",r,!1),a),[e._v(" Tải đính kèm ")])]}}])},[n("span",[e._v("Tick chọn các mail cần tải trước")])])]:e._e(),n("v-snackbar",{scopedSlots:e._u([{key:"action",fn:function(t){var a=t.attrs;return[n("v-btn",e._b({attrs:{color:"pink",text:""},on:{click:function(t){e.snackbarError=!1}}},"v-btn",a,!1),[e._v(" Close ")])]}}]),model:{value:e.snackbarError,callback:function(t){e.snackbarError=t},expression:"snackbarError"}},[e._v(" "+e._s(e.snackbarText)+" ")])],2)},c=[],l=(n(2801),n(655)),s=n(4028),u=n(5904),f=n(2569),h=n(4201),d=n(4002),b=n(8420),p=n(9669),m=n.n(p),v=n(5733),g=n.n(v),y=n(3162),k=n.n(y),w=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return Object.defineProperty(t,"accessToken",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(t,"fromDate",{enumerable:!0,configurable:!0,writable:!0,value:(0,h.Z)((0,f.Z)(new Date,{days:10}),"yyyy-MM-dd")}),Object.defineProperty(t,"toDate",{enumerable:!0,configurable:!0,writable:!0,value:(0,h.Z)(new Date,"yyyy-MM-dd")}),Object.defineProperty(t,"senderMailsRaw",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(t,"formValid",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(t,"rangeDateMenu",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(t,"headers",{enumerable:!0,configurable:!0,writable:!0,value:[{text:"STT",value:"index",align:"d-none",width:"80px"},{text:"Tiêu đề",value:"subject"},{text:"Thời gian",value:"receivedDateTime"},{text:"Người gửi",value:"sender"},{text:"Đính kèm",value:"hasAttachments",width:"80px"},{text:"Nội dung",value:"bodyPreview"}]}),Object.defineProperty(t,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(t,"selected",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(t,"snackbarError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(t,"snackbarText",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(t,"onlyAttachmentMail",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(t,"fetchingMail",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(t,"fetchingAttachment",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(t,"fetchingMaxAttachment",{enumerable:!0,configurable:!0,writable:!0,value:0}),t}return(0,l.ZT)(t,e),Object.defineProperty(t.prototype,"dateRangeText",{get:function(){return"".concat(this.fromDate," --\x3e ").concat(this.toDate)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"changeFormatDateToView",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,h.Z)((0,d.Z)(e,"yyyy-MM-dd",new Date),"dd/MM/yyyy")}}),Object.defineProperty(t.prototype,"fromDateComputed",{get:function(){return this.fromDate},set:function(e){this.fromDate=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"senderMails",{get:function(){return this.senderMailsRaw.split(/[,\s]/)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"validate",{enumerable:!1,configurable:!0,writable:!0,value:function(){return!!this.accessToken}}),Object.defineProperty(t.prototype,"formatDateTime",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,h.Z)((0,b.Z)(e),"yyyy/MM/dd HH:mm:ss")}}),Object.defineProperty(t.prototype,"itemsComputed",{get:function(){var e=(0,l.ev)([],this.items,!0);if(this.onlyAttachmentMail&&(e=e.filter((function(e){return e.hasAttachments}))),this.senderMails.length&&this.senderMails[0]){var t=new Set((0,l.ev)([],this.senderMails,!0));e=e.filter((function(e){return t.has(e.sender)}))}return e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parseDate",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,d.Z)(e,"yyyy-MM-dd",new Date)}}),Object.defineProperty(t.prototype,"preprocessMailTitle",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return e=e.replace(/\W+/,"_"),e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/đ/g,"d").replace(/Đ/g,"D")}}),Object.defineProperty(t.prototype,"userMail",{get:function(){return this.getUserMailByJwt(this.accessToken)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fetchMails",{enumerable:!1,configurable:!0,writable:!0,value:function(){return(0,l.mG)(this,void 0,void 0,(function(){var e,t,n,a,r,i=this;return(0,l.Jh)(this,(function(o){switch(o.label){case 0:if(!this.validate())return this.snackbarError=!0,this.snackbarText="Vui lòng điền đầy đủ thông tin trước",[2];this.items=[],e=this.parseDate(this.fromDate).getTime(),t="https://graph.microsoft.com/v1.0/me/messages?$select=sender,subject,receivedDateTime,hasAttachments,bodyPreview",this.fetchingMail=!0,o.label=1;case 1:o.trys.push([1,8,9,10]),o.label=2;case 2:0,n=void 0,o.label=3;case 3:return o.trys.push([3,5,,6]),[4,m().get(t,{headers:{Authorization:"Bearer "+this.accessToken}})];case 4:return n=o.sent(),[3,6];case 5:return o.sent(),this.snackbarError=!0,this.snackbarText="Lỗi trong quá trình lấy dữ liệu, Access Token không hợp lệ hoặc đã hết hạn.",[3,7];case 6:return a=n.data.value,a.forEach((function(t){var n,a,r=(0,b.Z)(t.receivedDateTime).getTime();e>r||(null===(n=t.sender)||void 0===n?void 0:n.emailAddress.address)!==i.userMail&&i.items.push({id:t.id,index:i.items.length+1,subject:t.subject,receivedDateTime:i.formatDateTime(t.receivedDateTime),sender:(null===(a=t.sender)||void 0===a?void 0:a.emailAddress.address)||"",hasAttachments:t.hasAttachments,bodyPreview:t.bodyPreview})})),(0,b.Z)(a[a.length-1].receivedDateTime).getTime()<e?[3,7]:(t=n.data["@odata.nextLink"],t?[3,2]:[3,7]);case 7:return[3,10];case 8:return r=o.sent(),this.snackbarError=!0,this.snackbarText="Có lỗi xảy ra, quá trình lấy dữ liệu không hoàn thành. "+r,[3,10];case 9:return this.fetchingMail=!1,[7];case 10:return[2]}}))}))}}),Object.defineProperty(t.prototype,"downloadAttachments",{enumerable:!1,configurable:!0,writable:!0,value:function(){var e=this.selected.filter((function(e){return e.hasAttachments}));this.fetchAttachments(e)}}),Object.defineProperty(t.prototype,"fetchAttachments",{enumerable:!1,configurable:!0,writable:!0,value:function(e){return(0,l.mG)(this,void 0,void 0,(function(){var t,n,a=this;return(0,l.Jh)(this,(function(r){return t=new(g()),this.fetchingAttachment=e.length,this.fetchingMaxAttachment=e.length,n=0,Promise.all(e.map((function(r){return m().get("https://graph.microsoft.com/v1.0/me/messages/".concat(r.id,"/attachments"),{headers:{Authorization:"Bearer "+a.accessToken}}).then((function(r){var i=r.data,o=t.folder("".concat(n+1,". ").concat(a.preprocessMailTitle(e[n].subject)));return i.value.forEach((function(e){null===o||void 0===o||o.file(e.name,e.contentBytes,{base64:!0})})),null===o||void 0===o||o.file("mail_content.json",JSON.stringify(e)),a.fetchingAttachment--,++n,r}))}))).then((function(){t.generateAsync({type:"blob",compression:"DEFLATE"}).then((function(e){k().saveAs(e,"outlook_attachments_".concat((0,h.Z)(new Date,"yyyy-MM-dd HH-mm-ss"),".zip"))}))})),[2]}))}))}}),Object.defineProperty(t.prototype,"getUserMailByJwt",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=this.parseJwt(e);return t.upn}}),Object.defineProperty(t.prototype,"parseJwt",{enumerable:!1,configurable:!0,writable:!0,value:function(e){var t=e.split(".")[1],n=t.replace(/-/g,"+").replace(/_/g,"/"),a=decodeURIComponent(window.atob(n).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""));return JSON.parse(a)}}),t=(0,l.gn)([u.ZP],t),t}(s.w3),x=w,M=x,_=n(1001),T=n(3453),A=n.n(T),j=n(3208),O=n(3702),D=n(2102),P=n(9846),Z=n(6175),S=n(9865),C=n(1418),V=n(6005),E=n(7003),R=n(2877),H=n(3202),J=n(9762),B=n(1328),F=n(5978),$=n(9330),z=(0,_.Z)(M,o,c,!1,null,"97b507a4",null),L=z.exports;A()(z,{VBtn:j.Z,VCheckbox:O.Z,VCol:D.Z,VContainer:P.Z,VDataTable:Z.Z,VDatePicker:S.Z,VDivider:C.Z,VMenu:V.Z,VProgressLinear:E.Z,VRow:R.Z,VSnackbar:H.Z,VSpacer:J.Z,VSwitch:B.Z,VTextField:F.Z,VTooltip:$.Z});var N=a.Z.extend({name:"App",components:{MailAttachmentsDownload:L},data:function(){return{}}}),q=N,G=n(7524),U=n(9930),I=n(899),K=n(7877),W=(0,_.Z)(q,r,i,!1,null,null,null),Q=W.exports;A()(W,{VApp:G.Z,VAppBar:U.Z,VFooter:I.Z,VMain:K.Z});var X=n(9132);a.Z.use(X.Z);var Y=new X.Z({});a.Z.config.productionTip=!1,new a.Z({vuetify:Y,render:function(e){return e(Q)}}).$mount("#app")}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var i=t[a]={exports:{}};return e[a].call(i.exports,i,i.exports,n),i.exports}n.m=e,function(){var e=[];n.O=function(t,a,r,i){if(!a){var o=1/0;for(u=0;u<e.length;u++){a=e[u][0],r=e[u][1],i=e[u][2];for(var c=!0,l=0;l<a.length;l++)(!1&i||o>=i)&&Object.keys(n.O).every((function(e){return n.O[e](a[l])}))?a.splice(l--,1):(c=!1,i<o&&(o=i));if(c){e.splice(u--,1);var s=r();void 0!==s&&(t=s)}}return t}i=i||0;for(var u=e.length;u>0&&e[u-1][2]>i;u--)e[u]=e[u-1];e[u]=[a,r,i]}}(),function(){n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,{a:t}),t}}(),function(){n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};n.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,i,o=a[0],c=a[1],l=a[2],s=0;if(o.some((function(t){return 0!==e[t]}))){for(r in c)n.o(c,r)&&(n.m[r]=c[r]);if(l)var u=l(n)}for(t&&t(a);s<o.length;s++)i=o[s],n.o(e,i)&&e[i]&&e[i][0](),e[i]=0;return n.O(u)},a=self["webpackChunkd6_batchdownloadmail"]=self["webpackChunkd6_batchdownloadmail"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=n.O(void 0,[998],(function(){return n(4306)}));a=n.O(a)})();
//# sourceMappingURL=app.5560889d.js.map